<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Proxy Request Tester</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, textarea { width: 100%; margin: 10px 0; padding: 8px; }
    button { padding: 10px 15px; margin-right: 10px; }
    pre { background: #f4f4f4; padding: 15px; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>Proxy Request Tester</h2>

  <label>Request (format: METHOD path)</label>
  <input type="text" id="request" placeholder="Example: GET v1/status">

  <label>Body (JSON for POST)</label>
  <textarea id="body" placeholder='{"key": "value"}'></textarea>

  <button onclick="sendRequest()">Send</button>

  <h3>Response</h3>
  <pre id="response"></pre>

  <script>
    async function sendRequest() {
      const reqInput = document.getElementById("request").value.trim();
      const body = document.getElementById("body").value;

      if (!reqInput) {
        alert("Please enter request like: GET v1/status");
        return;
      }

      // Split input into METHOD and PATH
      const parts = reqInput.split(" ");
      if (parts.length < 3) {
        alert("Invalid format. Use METHOD path (e.g., POST v1/status)");
        return;
      }

      const method = parts[0].toUpperCase();
      const url = parts[1];
      

      // Build payload
      let payload = { method, url };
      try {
        payload.body = body ? JSON.parse(body) : {};
      } catch (err) {
        alert("Body must be valid JSON");
        return;
      }

      try {
        const res = await fetch("http://localhost:4000/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const text = await res.text();
        let data;
        try { data = JSON.parse(text); }
        catch { data = text; }

        document.getElementById("response").textContent =
          typeof data === "object"
            ? JSON.stringify(data, null, 2)
            : data;

      } catch (err) {
        document.getElementById("response").textContent = "Error: " + err.message;
      }
    }
  </script>
</body>
</html>
